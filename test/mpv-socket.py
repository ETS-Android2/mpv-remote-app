#!/usr/bin/python3
# Program that continuously reads input to send to the mpv socket
# A list of properties can be found at the end of this file
# The first argument should be:
#   set  - set_property
#   get  - get_property
#   send - send_command
#   show - show_property
# Note: For boolean properties use "yes" and "no"

import subprocess
import json
import sys

SOCKET = "/tmp/mpvsocket"

def call(args):
    child = subprocess.Popen(' '.join(args), shell=True,
            stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    stdout, stderr = child.communicate()
    ret = child.poll()
    return (ret, stdout.decode().strip())

def socat(command):
    ret, out = call(["echo", "'%s'" % command, '|', "socat", "-", SOCKET])
    return out

def get_property(property):
    cmd = json.dumps({"command": ["get_property", property]})
    out = json.loads(socat(cmd))
    if out["error"] != "success":
        return None
    return out["data"]

def set_property(property, value):
    cmd = json.dumps({"command": ["set_property", property, value]})
    out = json.loads(socat(cmd))
    if out["error"] != "success":
        return False
    return True

def show_property(property, pre=None, post=""):
    if pre is None:
        pre = property.title() + ": "
    cmd = "show_text \"%s${%s}%s\"" % (pre, property, post)
    return socat(cmd)

def send_command(command, args):
    args = [str(arg) for arg in args]
    cmd = "%s %s" % (command, ' '.join(args))
    return socat(cmd)

while True:
    cmd = input().split()
    try:
        if cmd[0] == "set":
            print(set_property(cmd[1], cmd[2]))
        elif cmd[0] == "get":
            print(get_property(cmd[1]))
        elif cmd[0] == "send":
            print(send_command(cmd[1], cmd[2:]))
        elif cmd[0] == "show":
            print(show_property(cmd[1]))
    except:
        print("Error")

# Properties
#
#  speed
#  audio-speed-correction
#  video-speed-correction
#  display-sync-active
#  filename
#  stream-open-filename
#  file-size
#  path
#  media-title
#  stream-path
#  stream-capture
#  current-demuxer
#  file-format
#  stream-pos
#  stream-end
#  duration
#  avsync
#  total-avsync-change
#  drop-frame-count
#  mistimed-frame-count
#  vsync-ratio
#  vo-drop-frame-count
#  vo-delayed-frame-count
#  percent-pos
#  time-start
#  time-pos
#  time-remaining
#  audio-pts
#  playtime-remaining
#  playback-time
#  disc-title
#  chapter
#  edition
#  disc-titles
#  chapters
#  editions
#  angle
#  metadata
#  filtered-metadata
#  chapter-metadata
#  vf-metadata
#  af-metadata
#  pause
#  core-idle
#  eof-reached
#  seeking
#  playback-abort
#  cache-percent
#  cache-free
#  cache-used
#  cache-size
#  cache-idle
#  cache-speed
#  demuxer-cache-duration
#  demuxer-cache-time
#  demuxer-cache-idle
#  cache-buffering-state
#  paused-for-cache
#  clock
#  seekable
#  partially-seekable
#  idle-active
#  chapter-list
#  track-list
#  edition-list
#  disc-title-list
#  playlist
#  playlist-pos
#  playlist-pos-1
#  playlist-count
#  mixer-active
#  volume
#  mute
#  ao-volume
#  ao-mute
#  audio-delay
#  audio-codec-name
#  audio-codec
#  audio-params
#  audio-out-params
#  aid
#  balance
#  audio-device
#  audio-device-list
#  current-ao
#  audio-out-detected-device
#  fullscreen
#  deinterlace
#  taskbar-progress
#  ontop
#  border
#  on-all-workspaces
#  gamma
#  brightness
#  contrast
#  saturation
#  hue
#  video-output-levels
#  video-out-params
#  video-dec-params
#  video-params
#  video-format
#  video-frame-info
#  video-codec
#  dwidth
#  dheight
#  width
#  height
#  window-scale
#  vo-configured
#  vo-performance
#  current-vo
#  container-fps
#  estimated-vf-fps
#  video-aspect
#  vid
#  program
#  hwdec
#  hwdec-current
#  hwdec-interop
#  estimated-frame-count
#  estimated-frame-number
#  osd-width
#  osd-height
#  osd-par
#  osd-sym-cc
#  osd-ass-cc
#  sid
#  secondary-sid
#  sub-delay
#  sub-speed
#  sub-pos
#  sub-text
#  vf
#  af
#  ab-loop-a
#  ab-loop-b
#  packet-video-bitrate
#  packet-audio-bitrate
#  packet-sub-bitrate
#  video-bitrate
#  audio-bitrate
#  sub-bitrate
#  tv-brightness
#  tv-contrast
#  tv-saturation
#  tv-hue
#  tv-freq
#  tv-norm
#  tv-scan
#  tv-channel
#  dvb-channel
#  dvb-channel-name
#  cursor-autohide
#  ff-vid
#  ff-aid
#  ff-sid
#  window-minimized
#  display-names
#  display-fps
#  estimated-display-fps
#  vsync-jitter
#  framedrop
#  working-directory
#  protocol-list
#  decoder-list
#  encoder-list
#  mpv-version
#  mpv-configuration
#  ffmpeg-version
#  options
#  file-local-options
#  option-info
#  property-list
#  profile-list
#  video
#  audio
#  sub
#  colormatrix
#  colormatrix-input-range
#  colormatrix-primaries
#  colormatrix-gamma
#  shuffle
#  quiet
#  terminal
#  msg-level
#  dump-stats
#  msg-color
#  log-file
#  msg-module
#  msg-time
#  config
#  config-dir
#  reset-on-next-file
#  script
#  script-opts
#  osc
#  ytdl
#  ytdl-format
#  ytdl-raw-options
#  load-scripts
#  cache
#  cache-default
#  cache-initial
#  cache-seek-min
#  cache-backbuffer
#  cache-file
#  cache-file-size
#  dvd-device
#  dvd-speed
#  dvd-angle
#  bluray-device
#  frames
#  start
#  end
#  length
#  rebase-start-time
#  playlist-start
#  keep-open
#  image-display-duration
#  index
#  alang
#  slang
#  lavfi-complex
#  audio-display
#  hls-bitrate
#  display-tags
#  cdda-speed
#  cdda-paranoia
#  cdda-sector-size
#  cdda-overlap
#  cdda-toc-bias
#  cdda-toc-offset
#  cdda-skip
#  cdda-span
#  cdda-cdtext
#  cdrom-device
#  audio-file
#  demuxer
#  audio-demuxer
#  sub-demuxer
#  demuxer-thread
#  cache-pause
#  mf-fps
#  mf-type
#  tv-immediatemode
#  tv-audio
#  tv-audiorate
#  tv-driver
#  tv-device
#  tv-chanlist
#  tv-automute
#  tv-normid
#  tv-width
#  tv-height
#  tv-input
#  tv-outfmt
#  tv-fps
#  tv-channels
#  tv-gain
#  tv-amode
#  tv-volume
#  tv-bass
#  tv-treble
#  tv-balance
#  tv-forcechan
#  tv-forceaudio
#  tv-buffersize
#  tv-mjpeg
#  tv-decimation
#  tv-quality
#  tv-alsa
#  tv-adevice
#  tv-audioid
#  tv-scan-autostart
#  tv-scan-threshold
#  tv-scan-period
#  dvbin-prog
#  dvbin-card
#  dvbin-timeout
#  dvbin-file
#  dvbin-full-transponder
#  stream-lavf-o
#  http-header-fields
#  user-agent
#  referrer
#  cookies
#  cookies-file
#  tls-verify
#  tls-ca-file
#  tls-cert-file
#  tls-key-file
#  network-timeout
#  mc
#  fps
#  audio-samplerate
#  audio-channels
#  audio-format
#  audio-normalize-downmix
#  audio-pitch-correction
#  af-defaults
#  vf-defaults
#  ad
#  vd
#  audio-spdif
#  ad-spdif-dtshd
#  hwdec-codecs
#  video-aspect-method
#  field-dominance
#  vd-lavc-fast
#  vd-lavc-show-all
#  vd-lavc-skiploopfilter
#  vd-lavc-skipidct
#  vd-lavc-skipframe
#  vd-lavc-framedrop
#  vd-lavc-threads
#  vd-lavc-bitexact
#  vd-lavc-check-hw-profile
#  vd-lavc-software-fallback
#  vd-lavc-o
#  ad-lavc-ac3drc
#  ad-lavc-downmix
#  ad-lavc-threads
#  ad-lavc-o
#  demuxer-lavf-probesize
#  demuxer-lavf-format
#  demuxer-lavf-analyzeduration
#  demuxer-lavf-buffersize
#  demuxer-lavf-allow-mimetype
#  demuxer-lavf-probescore
#  demuxer-lavf-cryptokey
#  demuxer-lavf-hacks
#  demuxer-lavf-genpts-mode
#  demuxer-lavf-o
#  sub-codepage
#  rtsp-transport
#  demuxer-rawaudio-channels
#  demuxer-rawaudio-rate
#  demuxer-rawaudio-format
#  demuxer-rawvideo-w
#  demuxer-rawvideo-h
#  demuxer-rawvideo-format
#  demuxer-rawvideo-mp-format
#  demuxer-rawvideo-codec
#  demuxer-rawvideo-fps
#  demuxer-rawvideo-size
#  demuxer-mkv-subtitle-preroll
#  demuxer-mkv-subtitle-preroll-secs
#  demuxer-mkv-subtitle-preroll-secs-index
#  demuxer-mkv-probe-video-duration
#  demuxer-mkv-probe-start-time
#  sub-file
#  sub-paths
#  audio-file-paths
#  external-file
#  autoload-files
#  sub-fps
#  sub-visibility
#  sub-forced-only
#  stretch-dvd-subs
#  stretch-image-subs-to-screen
#  sub-fix-timing
#  sub-auto
#  audio-file-auto
#  sub-gauss
#  sub-gray
#  sub-ass
#  sub-scale
#  sub-ass-line-spacing
#  sub-use-margins
#  sub-ass-force-margins
#  sub-ass-vsfilter-aspect-compat
#  sub-ass-vsfilter-color-compat
#  sub-ass-vsfilter-blur-compat
#  embeddedfonts
#  sub-ass-force-style
#  sub-ass-styles
#  sub-ass-hinting
#  sub-ass-shaper
#  sub-ass-style-override
#  sub-scale-by-window
#  sub-scale-with-window
#  sub-ass-scale-with-window
#  osd-bar
#  osd-bar-align-x
#  osd-bar-align-y
#  osd-bar-w
#  osd-bar-h
#  osd-font
#  osd-font-size
#  osd-color
#  osd-border-color
#  osd-shadow-color
#  osd-back-color
#  osd-border-size
#  osd-shadow-offset
#  osd-spacing
#  osd-margin-x
#  osd-margin-y
#  osd-align-x
#  osd-align-y
#  osd-blur
#  osd-bold
#  osd-italic
#  sub-font
#  sub-font-size
#  sub-color
#  sub-border-color
#  sub-shadow-color
#  sub-back-color
#  sub-border-size
#  sub-shadow-offset
#  sub-spacing
#  sub-margin-x
#  sub-margin-y
#  sub-align-x
#  sub-align-y
#  sub-blur
#  sub-bold
#  sub-italic
#  sub-clear-on-seek
#  teletext-page
#  ao
#  pulse-host
#  pulse-sink
#  pulse-buffer
#  pulse-latency-hacks
#  alsa-device
#  alsa-resample
#  alsa-mixer-device
#  alsa-mixer-name
#  alsa-mixer-index
#  alsa-non-interleaved
#  alsa-ignore-chmap
#  oss-device
#  oss-mixer-device
#  oss-mixer-channel
#  jack-port
#  jack-name
#  jack-autostart
#  jack-connect
#  jack-std-channel-layout
#  ao-null-untimed
#  ao-null-buffer
#  ao-null-outburst
#  ao-null-speed
#  ao-null-latency
#  ao-null-broken-eof
#  ao-null-broken-delay
#  ao-null-channel-layouts
#  ao-pcm-file
#  ao-pcm-waveheader
#  ao-pcm-append
#  audio-exclusive
#  audio-client-name
#  audio-fallback-to-null
#  audio-stream-silence
#  audio-wait-open
#  force-window
#  softvol
#  volume-max
#  gapless-audio
#  audio-buffer
#  title
#  force-media-title
#  force-rgba-osd-rendering
#  video-rotate
#  video-stereo-mode
#  cursor-autohide-fs-only
#  stop-screensaver
#  heartbeat-cmd
#  heartbeat-interval
#  use-filedir-conf
#  osd-level
#  osd-duration
#  osd-fractions
#  osd-scale
#  osd-scale-by-window
#  sstep
#  untimed
#  stream-dump
#  stop-playback-on-init-failure
#  loop
#  loop-file
#  resume-playback
#  save-position-on-quit
#  write-filename-in-watch-later-config
#  ignore-path-in-watch-later-config
#  watch-later-directory
#  ordered-chapters
#  ordered-chapters-files
#  chapter-merge-threshold
#  chapter-seek-threshold
#  chapters-file
#  load-unsafe-playlists
#  merge-files
#  correct-pts
#  initial-audio-sync
#  video-sync
#  video-sync-max-video-change
#  video-sync-max-audio-change
#  video-sync-adrop-size
#  hr-seek
#  hr-seek-demuxer-offset
#  hr-seek-framedrop
#  autosync
#  term-osd
#  term-osd-bar
#  term-osd-bar-chars
#  term-playing-msg
#  osd-playing-msg
#  term-status-msg
#  osd-status-msg
#  osd-msg1
#  osd-msg2
#  osd-msg3
#  video-osd
#  idle
#  input-terminal
#  input-file
#  input-ipc-server
#  screenshot-jpeg-quality
#  screenshot-jpeg-smooth
#  screenshot-jpeg-source-chroma
#  screenshot-png-compression
#  screenshot-png-filter
#  screenshot-format
#  screenshot-high-bit-depth
#  screenshot-tag-colorspace
#  screenshot-template
#  screenshot-directory
#  input-conf
#  input-ar-delay
#  input-ar-rate
#  input-default-bindings
#  input-test
#  input-doubleclick-time
#  input-right-alt-gr
#  input-key-fifo-size
#  input-cursor
#  input-vo-keyboard
#  window-dragging
#  input-x11-keyboard
#  vo
#  opengl-glfinish
#  opengl-waitvsync
#  opengl-swapinterval
#  opengl-dwmflush
#  opengl-dcomposition
#  opengl-debug
#  opengl-backend
#  opengl-sw
#  opengl-es
#  opengl-check-pattern
#  opengl-vsync-fences
#  vo-vdpau-deint
#  vo-vdpau-chroma-deint
#  vo-vdpau-pullup
#  vo-vdpau-denoise
#  vo-vdpau-sharpen
#  vo-vdpau-hqscaling
#  vo-vdpau-fps
#  vo-vdpau-composite-detect
#  vo-vdpau-queuetime-windowed
#  vo-vdpau-queuetime-fs
#  vo-vdpau-output-surfaces
#  vo-vdpau-colorkey
#  vo-vdpau-force-yuv
#  vo-vdpau-queuetime_windowed
#  vo-vdpau-queuetime_fs
#  vo-vdpau-output_surfaces
#  vo-wayland-alpha
#  vo-wayland-rgb565
#  xv-port
#  xv-adaptor
#  xv-ck
#  xv-ck-method
#  xv-colorkey
#  xv-buffers
#  vo-vaapi-scaling
#  vo-vaapi-scaled-osd
#  vo-null-fps
#  vo-image-jpeg-quality
#  vo-image-jpeg-smooth
#  vo-image-jpeg-source-chroma
#  vo-image-png-compression
#  vo-image-png-filter
#  vo-image-format
#  vo-image-high-bit-depth
#  vo-image-tag-colorspace
#  vo-image-outdir
#  vo-tct-algo
#  vo-tct-width
#  vo-tct-height
#  vo-tct-256
#  hwdec-preload
#  sws-scaler
#  sws-lgb
#  sws-cgb
#  sws-cvs
#  sws-chs
#  sws-ls
#  sws-cs
#  fit-border
#  geometry
#  autofit
#  autofit-larger
#  autofit-smaller
#  force-window-position
#  x11-name
#  monitoraspect
#  monitorpixelaspect
#  fs
#  native-keyrepeat
#  panscan
#  video-zoom
#  video-pan-x
#  video-pan-y
#  video-align-x
#  video-align-y
#  video-unscaled
#  wid
#  screen
#  fs-screen
#  keepaspect
#  keepaspect-window
#  hidpi-window-scale
#  x11-netwm
#  x11-bypass-compositor
#  drm-connector
#  drm-mode
#  demuxer-readahead-secs
#  demuxer-max-packets
#  demuxer-max-bytes
#  force-seekable
#  cache-secs
#  access-references
#  opengl-dumb-mode
#  opengl-gamma
#  gamma-auto
#  target-prim
#  target-trc
#  target-brightness
#  hdr-tone-mapping
#  tone-mapping-param
#  opengl-pbo
#  scale
#  scale-param1
#  scale-param2
#  scale-blur
#  scale-taper
#  scale-wparam
#  scale-wblur
#  scale-wtaper
#  scale-clamp
#  scale-radius
#  scale-antiring
#  scale-window
#  dscale
#  dscale-param1
#  dscale-param2
#  dscale-blur
#  dscale-taper
#  dscale-wparam
#  dscale-wblur
#  dscale-wtaper
#  dscale-clamp
#  dscale-radius
#  dscale-antiring
#  dscale-window
#  cscale
#  cscale-param1
#  cscale-param2
#  cscale-blur
#  cscale-taper
#  cscale-wparam
#  cscale-wblur
#  cscale-wtaper
#  cscale-clamp
#  cscale-radius
#  cscale-antiring
#  cscale-window
#  tscale
#  tscale-param1
#  tscale-param2
#  tscale-blur
#  tscale-taper
#  tscale-wparam
#  tscale-wblur
#  tscale-wtaper
#  tscale-clamp
#  tscale-radius
#  tscale-antiring
#  tscale-window
#  scaler-lut-size
#  scaler-resizes-only
#  linear-scaling
#  correct-downscaling
#  sigmoid-upscaling
#  sigmoid-center
#  sigmoid-slope
#  opengl-fbo-format
#  dither-depth
#  dither
#  dither-size-fruit
#  temporal-dither
#  temporal-dither-period
#  alpha
#  opengl-rectangle-textures
#  background
#  interpolation
#  interpolation-threshold
#  blend-subtitles
#  opengl-shaders
#  deband
#  deband-iterations
#  deband-threshold
#  deband-range
#  deband-grain
#  sharpen
#  opengl-tex-pad-x
#  opengl-tex-pad-y
#  icc-profile
#  icc-profile-auto
#  icc-cache-dir
#  icc-intent
#  icc-contrast
#  icc-3dlut-size
#  3dlut-size
#  opengl-early-flush
#  o
#  of
#  ofopts
#  ofps
#  omaxfps
#  ovc
#  ovcopts
#  oac
#  oacopts
#  oharddup
#  ovoffset
#  oaoffset
#  ocopyts
#  orawts
#  oautofps
#  oneverdrop
#  ovfirst
#  oafirst
#  ometadata
#  aspect
#  ass
#  audiofile
#  cursor-autohide-delay
#  delay
#  dvdangle
#  endpos
#  font
#  forcedsubsonly
#  format
#  lua
#  lua-opts
#  mouse-movements
#  msgcolor
#  msgmodule
#  name
#  noar
#  noautosub
#  noconsolecontrols
#  nosound
#  osdlevel
#  playing-msg
#  spugauss
#  srate
#  ss
#  stop-xscreensaver
#  sub-fuzziness
#  subcp
#  subdelay
#  subfile
#  subfont-text-scale
#  subfont
#  subfps
#  subpos
#  tvscan
#  media-keys
#  right-alt-gr
#  autosub
#  autosub-match
#  status-msg
#  idx
#  forceidx
#  mkv-subtitle-preroll
#  dtshd
#  ass-use-margins
#  input-unix-socket
#  softvol-max
#  sub-text-font
#  sub-text-font-size
#  sub-text-color
#  sub-text-border-color
#  sub-text-shadow-color
#  sub-text-back-color
#  sub-text-border-size
#  sub-text-shadow-offset
#  sub-text-spacing
#  sub-text-margin-x
#  sub-text-margin-y
#  sub-text-align-x
#  sub-text-align-y
#  sub-text-blur
#  sub-text-bold
#  sub-text-italic
#  ass-line-spacing
#  ass-force-margins
#  ass-vsfilter-aspect-compat
#  ass-vsfilter-color-compat
#  ass-vsfilter-blur-compat
#  ass-force-style
#  ass-styles
#  ass-hinting
#  ass-shaper
#  ass-style-override
#  ass-scale-with-window
#
# Total: 823 properties
